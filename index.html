<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Serpent TV Simple</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        #gameArea {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        #gameCanvas {
            background-color: #000;
            display: block;
        }

        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            z-index: 100;
        }

        #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            text-align: center;
            z-index: 100;
        }

        .title {
            font-size: 60px;
            font-weight: bold;
            margin-bottom: 30px;
        }

        .instruction {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .blink {
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }

        #score {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 28px;
            font-weight: bold;
            z-index: 50;
        }

        .controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 50;
        }

        .control-btn {
            background-color: rgba(255,255,255,0.2);
            border: 2px solid #fff;
            color: #fff;
            font-size: 20px;
            padding: 15px;
            margin: 5px;
            cursor: pointer;
            width: 60px;
            height: 60px;
        }

        .control-row {
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="gameArea">
        <canvas id="gameCanvas"></canvas>
        
        <div id="score">Score: 0</div>
        
        <div id="startScreen">
            <div>
                <div class="title">SERPENT TV</div>
                <div class="instruction">Utilisez les flèches directionnelles</div>
                <div class="instruction">Mangez les points blancs</div>
                <div class="instruction blink">Appuyez sur une flèche pour commencer</div>
            </div>
        </div>

        <div id="gameOverScreen">
            <div>
                <div class="title" style="color: #ff4444;">GAME OVER</div>
                <div class="instruction">Score: <span id="finalScore">0</span></div>
                <div class="instruction blink">Appuyez sur une flèche pour rejouer</div>
            </div>
        </div>

        <div class="controls">
            <div class="control-row">
                <button class="control-btn" onclick="moveUp()">↑</button>
            </div>
            <div class="control-row">
                <button class="control-btn" onclick="moveLeft()">←</button>
                <button class="control-btn" onclick="startGame()" style="width: 80px;">START</button>
                <button class="control-btn" onclick="moveRight()">→</button>
            </div>
            <div class="control-row">
                <button class="control-btn" onclick="moveDown()">↓</button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales (compatible ancien JavaScript)
        var canvas = document.getElementById('gameCanvas');
        var ctx = canvas.getContext('2d');
        var scoreElement = document.getElementById('score');
        var startScreen = document.getElementById('startScreen');
        var gameOverScreen = document.getElementById('gameOverScreen');
        var finalScoreElement = document.getElementById('finalScore');

        var TILE_SIZE = 50;
        var GRID_WIDTH;
        var GRID_HEIGHT;

        var snake = [];
        var direction = {x: 1, y: 0};
        var food = {x: 5, y: 5};
        var score = 0;
        var gameRunning = false;
        var gameStarted = false;
        var gameLoop;

        // Fonction pour ajuster la taille
        function setupCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            GRID_WIDTH = Math.floor(canvas.width / TILE_SIZE);
            GRID_HEIGHT = Math.floor(canvas.height / TILE_SIZE);
        }

        // Fonction pour initialiser le serpent
        function initSnake() {
            var centerX = Math.floor(GRID_WIDTH / 2);
            var centerY = Math.floor(GRID_HEIGHT / 2);
            snake = [
                {x: centerX, y: centerY},
                {x: centerX - 1, y: centerY},
                {x: centerX - 2, y: centerY}
            ];
        }

        // Fonction pour dessiner un carré
        function drawSquare(x, y, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            ctx.strokeRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
        }

        // Fonction pour générer la nourriture
        function generateFood() {
            var validPosition = false;
            while (!validPosition) {
                food.x = Math.floor(Math.random() * GRID_WIDTH);
                food.y = Math.floor(Math.random() * GRID_HEIGHT);
                
                validPosition = true;
                for (var i = 0; i < snake.length; i++) {
                    if (snake[i].x === food.x && snake[i].y === food.y) {
                        validPosition = false;
                        break;
                    }
                }
            }
        }

        // Fonction pour dessiner le jeu
        function draw() {
            // Effacer l'écran
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Dessiner le serpent
            for (var i = 0; i < snake.length; i++) {
                if (i === 0) {
                    drawSquare(snake[i].x, snake[i].y, '#fff'); // Tête
                } else {
                    drawSquare(snake[i].x, snake[i].y, '#ccc'); // Corps
                }
            }

            // Dessiner la nourriture
            drawSquare(food.x, food.y, '#fff');
        }

        // Fonction pour mettre à jour le jeu
        function update() {
            if (!gameRunning) return;

            // Nouvelle position de la tête
            var head = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};

            // Vérifier les collisions avec les murs
            if (head.x < 0 || head.x >= GRID_WIDTH || head.y < 0 || head.y >= GRID_HEIGHT) {
                gameOver();
                return;
            }

            // Vérifier les collisions avec le corps
            for (var i = 0; i < snake.length; i++) {
                if (snake[i].x === head.x && snake[i].y === head.y) {
                    gameOver();
                    return;
                }
            }

            // Ajouter la nouvelle tête
            snake.unshift(head);

            // Vérifier si le serpent mange
            if (head.x === food.x && head.y === food.y) {
                score += 10;
                scoreElement.innerHTML = 'Score: ' + score;
                generateFood();
            } else {
                snake.pop();
            }
        }

        // Fonction pour démarrer le jeu
        function startGame() {
            gameRunning = true;
            gameStarted = true;
            startScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            
            setupCanvas();
            initSnake();
            generateFood();
            score = 0;
            scoreElement.innerHTML = 'Score: 0';
            
            if (gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(function() {
                update();
                draw();
            }, 200);
        }

        // Fonction game over
        function gameOver() {
            gameRunning = false;
            clearInterval(gameLoop);
            finalScoreElement.innerHTML = score;
            gameOverScreen.style.display = 'flex';
        }

        // Fonctions de mouvement
        function moveUp() {
            if (!gameStarted) {
                startGame();
                return;
            }
            if (gameRunning && direction.y === 0) {
                direction = {x: 0, y: -1};
            }
            if (!gameRunning && gameStarted) {
                startGame();
            }
        }

        function moveDown() {
            if (!gameStarted) {
                startGame();
                return;
            }
            if (gameRunning && direction.y === 0) {
                direction = {x: 0, y: 1};
            }
            if (!gameRunning && gameStarted) {
                startGame();
            }
        }

        function moveLeft() {
            if (!gameStarted) {
                startGame();
                return;
            }
            if (gameRunning && direction.x === 0) {
                direction = {x: -1, y: 0};
            }
            if (!gameRunning && gameStarted) {
                startGame();
            }
        }

        function moveRight() {
            if (!gameStarted) {
                startGame();
                return;
            }
            if (gameRunning && direction.x === 0) {
                direction = {x: 1, y: 0};
            }
            if (!gameRunning && gameStarted) {
                startGame();
            }
        }

        // Gestionnaire de touches (méthode ancienne)
        document.onkeydown = function(e) {
            var keyCode = e.keyCode || e.which;
            
            // Flèche haut
            if (keyCode === 38) {
                moveUp();
                return false;
            }
            // Flèche bas
            if (keyCode === 40) {
                moveDown();
                return false;
            }
            // Flèche gauche
            if (keyCode === 37) {
                moveLeft();
                return false;
            }
            // Flèche droite
            if (keyCode === 39) {
                moveRight();
                return false;
            }
            // Entrée ou espace
            if (keyCode === 13 || keyCode === 32) {
                if (!gameStarted || !gameRunning) {
                    startGame();
                }
                return false;
            }
        };

        // Gestionnaire de redimensionnement
        window.onresize = function() {
            setupCanvas();
            draw();
        };

        // Initialisation
        setupCanvas();
        draw();
    </script>
</body>
</html>